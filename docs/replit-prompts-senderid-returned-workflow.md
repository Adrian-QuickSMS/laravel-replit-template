# Replit Prompts — SenderID Returned Workflow

> 9 sequential prompts for Replit to implement the full "Returned SenderID" feature across customer portal, admin console, notifications, comments, and audit.

---

## PROMPT 1: Customer Portal — Notification Model & SenderID Returned Event

Create a persistent notification system for the customer portal. This app is Laravel 10 with Blade templates, PostgreSQL, and the Fillow Bootstrap UI framework.

MIGRATION — Create a `notifications` table:
- id (bigint, auto-increment primary key)
- uuid (uuid, unique, generated by PostgreSQL trigger like existing tables)
- tenant_id (uuid, foreign key to accounts.id — required for RLS)
- user_id (uuid, nullable — if null, notification is tenant-wide)
- type (varchar) — e.g. 'SENDERID_RETURNED'
- severity (varchar) — 'info', 'warning', 'error'
- title (varchar)
- body (text)
- deep_link (varchar, nullable) — relative URL path
- read_at (timestamp, nullable) — null = unread
- dismissed_at (timestamp, nullable) — null = not dismissed
- resolved_at (timestamp, nullable) — auto-resolved when underlying issue is fixed
- meta (jsonb, nullable) — flexible payload for type-specific data (e.g. sender_id_value, request_uuid)
- created_at (timestamp)
- No updated_at, no soft deletes — notifications are immutable except for read/dismissed/resolved

Add a Row Level Security (RLS) policy matching the existing pattern used in `database/migrations/2026_02_14_000003_create_sender_ids_table.php` — scope by `app.current_tenant_id`.

MODEL — Create `app/Models/Notification.php`:
- Fillable: type, severity, title, body, deep_link, meta, tenant_id, user_id
- Cast meta as array, read_at/dismissed_at/resolved_at as datetime
- Scopes: scopeUnread (where read_at is null AND resolved_at is null), scopeOfType($type), scopeForTenant($tenantId)
- Methods: markAsRead(), markAsDismissed(), markAsResolved(), isUnread()
- Boot method: auto-scope by auth()->user()->tenant_id using the same pattern as `app/Models/SenderId.php` (global scope on tenant)

TRIGGER POINT — In `app/Http/Controllers/Admin/SenderIdApprovalController.php`, inside the `requestInfo()` method (which transitions in_review → pending_info):
After the `performTransition()` call succeeds, create a Notification record:
- tenant_id = the sender ID request's account_id
- type = 'SENDERID_RETURNED'
- severity = 'warning'
- title = "Sender ID needs more information"
- body = "Your Sender ID '{sender_id_value}' was returned with comments. Please review and resubmit."
- deep_link = "/management/sms-sender-id?view={uuid}" (using the sender ID's uuid)
- meta = { sender_id_value: '...', request_uuid: '...', request_id: ... }

API ENDPOINT — Add to customer API routes in `routes/web.php` under the existing `api/sender-ids` prefix group:
- GET /api/notifications — list unread notifications for current tenant (use session('customer_tenant_id'))
- POST /api/notifications/{uuid}/read — mark notification as read (set read_at = now())
- POST /api/notifications/{uuid}/dismiss — mark as dismissed (set dismissed_at = now(), read_at = now() if null)

CONTROLLER — Create `app/Http/Controllers/NotificationController.php`:
- index(): return unread + undismissed notifications for current tenant, ordered by created_at desc
- markRead($uuid): find by uuid scoped to tenant, set read_at
- dismiss($uuid): find by uuid, set dismissed_at and read_at

Protect all routes with the existing `customer.auth` middleware group used for other customer API routes.

---

## PROMPT 2: Customer Portal — Login Banner for Returned SenderID

Add a warning banner to the customer portal that appears when there are unread SENDERID_RETURNED notifications. This should follow the exact same pattern as the existing TEST mode activation banner in `resources/views/layouts/quicksms.blade.php`.

BANNER PARTIAL — Create `resources/views/partials/customer/senderid-returned-banner.blade.php`:
Use the Fillow `alert alert-warning left-icon-big alert-dismissible fade show` pattern (see `resources/views/fillow/ui/alert.blade.php` for reference — the "Alert left icon big" section with the warning variant using `mdi mdi-help-circle-outline` icon).

Structure:
```html
<div id="senderid-returned-banner" class="alert alert-warning left-icon-big alert-dismissible fade show" style="display:none; margin: 0 0 1rem 0;">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" onclick="dismissSenderIdBanner(this)"></button>
    <div class="media">
        <div class="alert-left-icon-big">
            <span><i class="mdi mdi-alert"></i></span>
        </div>
        <div class="media-body">
            <h6 class="mt-1 mb-2">Action required: Sender ID '<span id="senderid-returned-name"></span>' needs more information</h6>
            <p class="mb-0">Your registration was returned with comments from the review team.
                <a href="#" id="senderid-returned-link" class="alert-link fw-bold">View request</a>
            </p>
        </div>
    </div>
</div>
```

LAYOUT INTEGRATION — In `resources/views/layouts/quicksms.blade.php`, add an @include for this partial. Place it in the @push('scripts') block AFTER the existing test-mode banner logic (after line ~101).

Add JavaScript in the same script block that:
1. On DOMContentLoaded, fetches GET /api/notifications?type=SENDERID_RETURNED
2. If any unread notifications exist, shows the banner with the first notification's data:
   - Set #senderid-returned-name text to notification.meta.sender_id_value
   - Set #senderid-returned-link href to notification.deep_link
   - Store notification.uuid in a data attribute for dismiss
3. Show the banner div (display: block)

JavaScript functions:
- dismissSenderIdBanner(btn): POST /api/notifications/{uuid}/dismiss, then hide the banner. Include CSRF token from meta[name="csrf-token"] (already in `resources/views/layouts/default.blade.php` line 14).
- When user clicks "View request" link: POST /api/notifications/{uuid}/read before navigating

PERSISTENCE RULES (match the test-mode banner pattern):
- Banner shows on every page load until dismissed or the notification is resolved
- If notification's resolved_at is set (because customer resubmitted), do NOT show the banner
- Banner appears in the same visual position as the test-mode-activation-banner — just below the header, above page content
- Only show ONE banner even if multiple returned notifications exist (show the most recent)

---

## PROMPT 3: Customer Portal — SenderID Returned Workflow UI

Enhance the existing SMS SenderID list and detail views to handle the "Returned" workflow. The current views are at `resources/views/quicksms/management/sms-sender-id.blade.php` (list) and the SenderID detail is loaded via JavaScript fetching from `GET /api/sender-ids/{uuid}`.

EXISTING STATUS CONTEXT: The SenderId model (`app/Models/SenderId.php`) currently uses `pending_info` as the status when admin requests more information. The existing status constants are: draft, submitted, in_review, pending_info, info_provided, approved, rejected, suspended, revoked.

LIST VIEW — In `resources/views/quicksms/management/sms-sender-id.blade.php`:
The list already renders status pills for each SenderID. When status = 'pending_info':
- Keep the existing status pill (it likely shows as a warning/amber badge)
- Add a tooltip or small helper text next to the pill: "Returned with comments — action required"
- Use Bootstrap tooltip: `data-bs-toggle="tooltip" title="Returned with comments — action required"`
- Add a small `<i class="fas fa-exclamation-circle text-warning ms-1"></i>` icon next to the status text

DETAIL VIEW / SIDE PANEL — When the detail panel loads a SenderID with status = 'pending_info':
The existing partial `resources/views/partials/customer/changes-required-banner.blade.php` already handles displaying the admin's return message with:
- A yellow/amber banner with the admin comments
- "Edit & Resubmit" and "View Original" buttons
- Reason code and timestamp

Enhance this to also show a dedicated response area below the banner. Add to the JavaScript that renders the detail view:

1. "Admin Comments" section (read-only, non-collapsible):
   - Display the admin's customer-facing notes. The existing `requestInfo()` method in `SenderIdApprovalController.php` stores the admin message in the `reason` parameter of `transitionTo()`. This gets saved in `sender_id_status_history` table. Fetch the latest status history entry where to_status = 'pending_info' and display its `reason` field.
   - Label: "Comments from QuickSMS Review Team"
   - Show timestamp: "Returned on {date}"
   - Style using the same card pattern as the changes-required-banner (amber/warning theme)

2. "Your Response" section (below admin comments):
   - A textarea with id="customer-response-text"
   - Placeholder: "Provide supporting information, proof of brand ownership, intended use, etc."
   - Required — validated before resubmit
   - Style: standard Fillow form control (`form-control` class)

3. "Attach Evidence" stub (optional future enhancement):
   - A disabled file input or placeholder text: "File attachments coming soon"
   - Style as a light muted area so it's clearly not functional yet

4. Action buttons:
   - Primary CTA: "Resubmit" — calls POST /api/sender-ids/{uuid}/provide-info with the response text in the `additional_info` field. This endpoint already exists in `SenderIdController.php` as the `provideInfo()` method.
   - Resubmit validation: textarea must not be empty. Show Fillow inline validation error if empty.
   - On success: show a Toastr success notification "Your response has been submitted for review" and refresh the detail view

Use the existing card styling from Fillow: `.card` with `.card-header` and `.card-body`. Use the warning color scheme (amber/yellow borders) for the admin comments section, and the default white card for the response area.

---

## PROMPT 4: SenderID Comments & Audit Model

Add a structured comment model for SenderID requests. This Laravel 10 app uses PostgreSQL with RLS.

MIGRATION — Create `sender_id_comments` table:
- id (bigint, auto-increment primary key)
- uuid (uuid, unique — use PostgreSQL trigger for generation, matching pattern in existing migrations like `2026_02_14_000005_create_sender_id_status_history_table.php`)
- sender_id_id (bigint, foreign key to sender_ids.id, cascade delete)
- comment_type (varchar) — 'internal' or 'customer' (internal = admin-only, customer = visible to customer portal)
- comment_text (text, not null)
- created_by_actor_type (varchar) — 'admin', 'customer', or 'system'
- created_by_actor_id (uuid, nullable) — the user/admin ID who wrote it
- created_by_actor_name (varchar, nullable) — display name for audit
- created_at (timestamp)
- No updated_at — comments are immutable once created

Index on (sender_id_id, comment_type) for efficient filtered queries.
Do NOT add RLS to this table — access control is handled at the application layer via the parent SenderID's tenant scoping.

MODEL — Create `app/Models/SenderIdComment.php`:
- Belongs to SenderId (sender_id_id)
- Fillable: sender_id_id, comment_type, comment_text, created_by_actor_type, created_by_actor_id, created_by_actor_name
- Cast created_at as datetime
- Constants: TYPE_INTERNAL = 'internal', TYPE_CUSTOMER = 'customer'
- Constants: ACTOR_ADMIN = 'admin', ACTOR_CUSTOMER = 'customer', ACTOR_SYSTEM = 'system'
- Scopes: scopeCustomerVisible (where comment_type = 'customer'), scopeInternal (where comment_type = 'internal')
- Method: toPortalArray() — returns only id, uuid, comment_text, created_by_actor_type (display as 'QuickSMS Review Team' if admin), created_at. NEVER expose actor_id or actor_name to customer portal.
- Method: toAdminArray() — returns all fields

RELATIONSHIP — Add to `app/Models/SenderId.php`:
- hasMany relationship: comments() → SenderIdComment
- Helper: customerComments() → comments()->customerVisible()->orderBy('created_at', 'desc')
- Helper: internalComments() → comments()->internal()->orderBy('created_at', 'desc')

INTEGRATION — Admin side (`app/Http/Controllers/Admin/SenderIdApprovalController.php`):
In the `requestInfo()` method, after the transition succeeds:
- Create a SenderIdComment with comment_type = 'customer', the admin's notes text, actor_type = 'admin'
- This makes the comment visible to the customer

In `show()` method: include comments (both types) in the admin response via toAdminArray()

INTEGRATION — Customer side (`app/Http/Controllers/SenderIdController.php`):
In the `provideInfo()` method, when customer responds:
- Create a SenderIdComment with comment_type = 'customer', the customer's response text, actor_type = 'customer'

In `show()` method: include only customerComments in the portal response via toPortalArray()

AUDIT EVENTS — Add to the existing `governance_audit_events` logging pattern used in `SenderIdApprovalController.php` (see the `logGovernanceEvent()` calls around line 272):
- SENDERID_RETURNED_TO_CUSTOMER — logged when admin uses requestInfo(), include request_id, comment text present (Y/N)
- SENDERID_CUSTOMER_RESUBMITTED — logged when customer uses provideInfo(), include request_id, customer user_id, account_id
- SENDERID_COMMENT_ADDED — logged when any customer-facing comment is created, include actor_type and request_id

---

## PROMPT 5: SenderID Workflow — Returned to Resubmitted Loop

The existing SenderID workflow in `app/Models/SenderId.php` already has a return/resubmit loop:
- pending_info → info_provided (customer provides info)
- info_provided → in_review (admin picks it back up)

This is functionally equivalent to the "Returned → Resubmitted" flow. The existing status constants and transitions already handle this:
- STATUS_PENDING_INFO = 'pending_info' (equivalent to "Returned to Customer")
- STATUS_INFO_PROVIDED = 'info_provided' (equivalent to "Resubmitted by Customer")

The TRANSITIONS array in SenderId.php (around line 54) already defines:
- 'pending_info' => ['info_provided']
- 'info_provided' => ['in_review']

ENHANCEMENT — When customer clicks "Resubmit" and the provideInfo() method in `SenderIdController.php` transitions pending_info → info_provided:

1. In `SenderIdController.php` provideInfo() method, after successful transition:
   - Ensure updated_at is refreshed (Laravel does this automatically)
   - Ensure the version is incremented (the existing `recordStatusHistory()` in SenderId.php already snapshots version_history)
   - Auto-resolve any SENDERID_RETURNED notifications for this request:
     ```php
     \App\Models\Notification::where('type', 'SENDERID_RETURNED')
         ->where('tenant_id', $senderId->account_id)
         ->whereJsonContains('meta->request_uuid', $senderId->uuid)
         ->whereNull('resolved_at')
         ->update(['resolved_at' => now()]);
     ```

2. In `SenderIdApprovalController.php`, when an admin transitions info_provided → in_review (the existing review flow handles this):
   - This already works via the existing `startReview()` method or equivalent transition handler
   - No changes needed — info_provided items already appear in the admin queue as reviewable

DISPLAY LABELS — For customer-facing UI, map the internal statuses to friendly labels:
- 'pending_info' → display as "Returned — Action Required" (amber/warning pill)
- 'info_provided' → display as "Resubmitted — Pending Review" (blue/info pill)

Add these display mappings to the JavaScript that renders status pills in `resources/views/quicksms/management/sms-sender-id.blade.php`. The existing status rendering logic likely has a switch/map for status → label/color. Add or update:
```javascript
var statusLabels = {
    'draft': { label: 'Draft', class: 'badge-secondary' },
    'submitted': { label: 'Submitted', class: 'badge-primary' },
    'in_review': { label: 'In Review', class: 'badge-info' },
    'pending_info': { label: 'Returned — Action Required', class: 'badge-warning' },
    'info_provided': { label: 'Resubmitted', class: 'badge-info' },
    'approved': { label: 'Approved', class: 'badge-success' },
    'rejected': { label: 'Rejected', class: 'badge-danger' },
    'suspended': { label: 'Suspended', class: 'badge-dark' },
    'revoked': { label: 'Revoked', class: 'badge-dark' }
};
```

The full lifecycle flow is:
draft → submitted → in_review → pending_info → info_provided → in_review → approved/rejected

This loop (pending_info ↔ info_provided ↔ in_review) can repeat multiple times.

---

## PROMPT 6: Admin Console — Pending Actions for Resubmitted SenderIDs

Enhance the Admin approval queue to highlight resubmitted SenderID requests. The admin approval queue is at `resources/views/admin/approval-queue.blade.php` and data comes from `app/Http/Controllers/Admin/ApprovalQueueController.php`.

QUEUE COUNTS — In `ApprovalQueueController.php` getQueueCounts() method:
Add a count for 'info_provided' status (this is the "Resubmitted" status in the workflow). Add it alongside existing counts:
```php
$resubmittedCount = SenderId::withoutGlobalScope('tenant')
    ->where('workflow_status', 'info_provided')
    ->count();
```
Return this as 'resubmitted' in the counts response.

QUEUE VIEW — In `resources/views/admin/approval-queue.blade.php`:
Add a new stat card in the `.queue-stats-row` section (matching the existing card pattern with classes like `queue-stat-card`):
```html
<div class="queue-stat-card resubmitted" onclick="filterByStatus('info_provided')">
    <div class="stat-count" id="resubmitted-count">0</div>
    <div class="stat-label">Resubmitted</div>
</div>
```
Add CSS for the resubmitted color: `.queue-stat-card.resubmitted .stat-count { color: #7c3aed; }` (purple, to distinguish from other statuses).

FILTER — In the filter panel (`.filter-panel` section), add 'info_provided' / "Resubmitted" as a filter option in the Status dropdown.

LIST DISPLAY — When rendering SenderID items in the queue list:
If status = 'info_provided':
- Show status pill with class `badge bg-purple text-white` or similar (purple/violet): "Resubmitted"
- Add a row indicator: `<span class="badge badge-sm bg-info ms-2">New customer comments</span>`
- Show timestamp: "Customer responded {relative_time}"
- Show account name and SenderID value (these are already in the list item template)

SORTING — Modify the query in `getSenderIdRequests()` in `ApprovalQueueController.php`:
- When no explicit sort is applied, order by:
  1. info_provided items first (prioritized)
  2. Then by updated_at desc

Use a CASE expression:
```php
$query->orderByRaw("CASE WHEN workflow_status = 'info_provided' THEN 0 ELSE 1 END ASC")
      ->orderBy('updated_at', 'desc');
```

NAVIGATION — When admin clicks a Resubmitted item in the queue:
Navigate to the existing SenderID detail page at `/admin/assets/sender-ids/{id}` (which uses `resources/views/admin/assets/sender-id-detail.blade.php`). No new page needed.

---

## PROMPT 7: Admin SenderID Review — Customer Response Display

Enhance the existing admin SenderID detail view to show customer responses when status = info_provided (Resubmitted).

The admin detail view is `resources/views/admin/assets/sender-id-detail.blade.php` and the action panel is `resources/views/partials/admin/approval-action-panel.blade.php`.

CUSTOMER RESPONSE SECTION — When loading a SenderID with status = 'info_provided', add a prominent section at the TOP of the detail view (above the existing detail cards):

Use the Fillow card component with a highlighted border:
```html
<div class="card border-primary" id="customer-response-section" style="display:none; border-left: 4px solid #7c3aed;">
    <div class="card-header" style="background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white;">
        <h5 class="card-title mb-0" style="color: white;">
            <i class="fas fa-reply me-2"></i>Customer Response
        </h5>
        <span class="badge bg-light text-dark">New</span>
    </div>
    <div class="card-body">
        <div class="alert alert-info mb-3">
            <i class="fas fa-info-circle me-2"></i>
            Customer has provided additional information in response to your review comments.
        </div>
        <div class="mb-3">
            <label class="form-label fw-bold">Customer's Response:</label>
            <div id="customer-response-text" class="p-3 bg-light rounded border"></div>
        </div>
        <div class="text-muted small">
            <i class="fas fa-clock me-1"></i>
            Responded: <span id="customer-response-time"></span>
        </div>
    </div>
</div>
```

Populate this section by fetching the SenderID's comments via the admin API endpoint (GET /admin/api/sender-ids/{uuid}) which should now include comments (from Prompt 4). Filter for the latest comment where created_by_actor_type = 'customer'.

COMMENT HISTORY TIMELINE — Below the customer response, show a read-only timeline of all previous comments (both admin and customer, since this is admin view):
```html
<div class="card" id="comment-history-section">
    <div class="card-header">
        <h5 class="card-title mb-0"><i class="fas fa-history me-2"></i>Review History</h5>
    </div>
    <div class="card-body">
        <div class="timeline" id="comment-timeline">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>
```

Each timeline entry shows:
- Actor icon: admin (shield icon, blue) or customer (user icon, purple)
- Actor label: "QuickSMS Review Team" or "Customer"
- Comment text
- Timestamp
- Use the Fillow timeline/activity pattern if one exists, otherwise use a simple bordered-left div list

ADMIN ACTIONS — The existing approval action panel (`resources/views/partials/admin/approval-action-panel.blade.php`) already has Approve, Reject, and Request Info buttons. When status = 'info_provided':
- The admin first needs to transition info_provided → in_review (start review)
- Then the Approve/Reject/Request Info buttons become available
- This already works with the existing `startReview()` method in `SenderIdApprovalController.php`
- No changes to the action buttons needed — they already handle the full state machine

---

## PROMPT 8: Admin Notifications — Customer Responded

Add admin-side notifications when a customer resubmits a SenderID request.

ADMIN NOTIFICATION TABLE — Create an `admin_notifications` table (separate from customer notifications to maintain RED/GREEN data boundary):
- id (bigint, primary key)
- uuid (uuid, unique)
- recipient_admin_id (uuid, nullable — null means all admins)
- type (varchar) — e.g. 'CUSTOMER_RESPONDED_SENDERID'
- severity (varchar) — 'info', 'warning'
- title (varchar)
- body (text)
- deep_link (varchar, nullable) — admin-relative URL
- meta (jsonb, nullable)
- read_at (timestamp, nullable)
- created_at (timestamp)
- No RLS needed — admin tables are behind admin auth middleware

MODEL — Create `app/Models/AdminNotification.php`:
- Same pattern as the customer Notification model but without RLS/tenant scoping
- Scopes: scopeUnread, scopeOfType
- Methods: markAsRead()

TRIGGER — In `app/Http/Controllers/SenderIdController.php`, in the `provideInfo()` method:
After the transition pending_info → info_provided succeeds, create an AdminNotification:
```php
AdminNotification::create([
    'type' => 'CUSTOMER_RESPONDED_SENDERID',
    'severity' => 'info',
    'title' => 'Customer responded to SenderID review',
    'body' => $senderId->account->company_name . ' has provided additional info for SenderID ' . $senderId->sender_id_value,
    'deep_link' => '/admin/assets/sender-ids/' . $senderId->id,
    'meta' => [
        'request_uuid' => $senderId->uuid,
        'sender_id_value' => $senderId->sender_id_value,
        'account_name' => $senderId->account->company_name ?? 'Unknown',
        'account_id' => $senderId->account_id,
    ],
]);
```

ADMIN API — Add endpoints in `routes/web.php` under the admin route group (matching existing admin API prefix pattern `/admin/api/`):
- GET /admin/api/notifications — list unread admin notifications
- POST /admin/api/notifications/{uuid}/read — mark as read

CONTROLLER — Create `app/Http/Controllers/Admin/AdminNotificationController.php`

BELL ICON — In the admin layout (`resources/views/layouts/admin.blade.php`), find the header/navbar area. Add or enhance the bell icon:
- On page load, fetch GET /admin/api/notifications and show unread count as a badge
- Use the Fillow header notification dropdown pattern (the same bell icon pattern from the Fillow theme)
- Clicking a notification navigates to its deep_link and marks it as read
- Badge shows count of unread notifications
- Clicking the bell opens a dropdown showing recent notifications with title, body preview, and timestamp

---

## PROMPT 9: Audit Events — Complete Logging

Ensure all SenderID workflow events are properly logged to the governance_audit_events table. The existing audit pattern is in `app/Http/Controllers/Admin/SenderIdApprovalController.php` around line 272, using a `logGovernanceEvent()` helper.

The governance_audit_events table has columns: event_uuid, event_type, entity_type, entity_id, actor_id, actor_type, before_state (json), after_state (json), reason, source_ip, user_agent, created_at.

EVENTS TO LOG:

1. SENDERID_RETURNED_TO_CUSTOMER
   Location: `SenderIdApprovalController.php` → `requestInfo()` method
   Already partially logged via the existing transition logging. Enhance to explicitly log:
   - event_type: 'SENDERID_RETURNED_TO_CUSTOMER'
   - entity_type: 'sender_id'
   - entity_id: the sender ID's id
   - actor_type: 'ADMIN'
   - actor_id: the admin user's ID from session
   - before_state: { status: 'in_review' }
   - after_state: { status: 'pending_info' }
   - reason: the admin's customer-facing comment text
   - source_ip: $request->ip()
   - user_agent: $request->userAgent()

2. SENDERID_CUSTOMER_RESUBMITTED
   Location: `SenderIdController.php` → `provideInfo()` method
   Add governance event logging (this controller may not currently log to governance_audit_events — add it):
   - event_type: 'SENDERID_CUSTOMER_RESUBMITTED'
   - entity_type: 'sender_id'
   - entity_id: the sender ID's id
   - actor_type: 'CUSTOMER'
   - actor_id: session('customer_user_id')
   - before_state: { status: 'pending_info' }
   - after_state: { status: 'info_provided' }
   - reason: null (customer response is in the comment, not duplicated here)

3. SENDERID_ADMIN_REVIEW_REOPENED
   Location: `SenderIdApprovalController.php` → wherever info_provided → in_review transition happens (likely `startReview()`)
   - event_type: 'SENDERID_ADMIN_REVIEW_REOPENED'
   - entity_type: 'sender_id'
   - actor_type: 'ADMIN'
   - before_state: { status: 'info_provided' }
   - after_state: { status: 'in_review' }

4. SENDERID_COMMENT_ADDED
   Log whenever a customer-facing comment is created (from Prompt 4's SenderIdComment creation):
   - event_type: 'SENDERID_COMMENT_ADDED'
   - entity_type: 'sender_id_comment'
   - actor_type: the comment's created_by_actor_type ('admin' or 'customer')

For customer-side audit logging, if the governance_audit_events table is admin-only, alternatively use the `sender_id_status_history` table which already captures transitions with actor info, IP, and user agent (see `SenderIdStatusHistory` model). The `transitionTo()` method in SenderId.php already creates these records. Verify that provideInfo() calls transitionTo() with the customer's user info — if so, this is already logged there and the governance event is supplementary.
